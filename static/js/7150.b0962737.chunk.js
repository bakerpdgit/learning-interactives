"use strict";(self.webpackChunkclass_interactives=self.webpackChunkclass_interactives||[]).push([[7150],{7150:(t,e,n)=>{n.r(e),n.d(e,{default:()=>h});var a=n(2791),s=n(8363);const i="Geometry_GameArea__gNHN7";var r=n(184);const h=function(t){let{text:e}=t;const[n,h]=(0,a.useState)([]),[o,x]=(0,a.useState)([]),[c,l]=(0,a.useState)({width:0,height:0}),[g,y]=(0,a.useState)(!0),[d,u]=(0,a.useState)({x:0,y:0}),[p,m]=(0,a.useState)({angles:"no"}),[w,f]=(0,a.useState)([]),[b,M]=(0,a.useState)({width:1e3,height:1e3}),v=t=>{y(!1),u({x:t.target.x(),y:t.target.y()})},k=(t,e)=>{h((n=>{const a=[...n];return a[t].length>=1&&(a[t]=[...a[t].slice(0,e),...a[t].slice(e+1)],D(a)),a}))},j=(t,e)=>{const a=c.width/b.width,s=c.height/b.height,i=(t.target.x()-d.x)/a,r=(t.target.y()-d.y)/s,o=n.map(((t,n)=>n===e?t.map((t=>({x:t.x+i,y:t.y+r}))):t));h(o),D(o),y(!0),t.target.position({x:d.x,y:d.y}),t.target.getLayer().batchDraw()},D=(0,a.useCallback)((t=>{const e=c.width/b.width,n=c.height/b.height,a=t.map((t=>t.map((t=>({x:t.x*e,y:t.y*n})))));x(a)}),[c,b]);function S(){const t=.9*window.innerWidth,e=.9*window.innerHeight-100,n=t/e*1e3;l({width:t,height:e}),M({width:n,height:1e3})}(0,a.useEffect)((()=>{D(n)}),[c,n,D]),(0,a.useEffect)((()=>{const{options:t,points:n,shapeTypes:a}=function(t){const e=t.split("\n");let n={angles:"no"},a=[],s=[];return e.forEach((t=>{if(t.startsWith("OPTIONS:"))t.substring(8).split(",").forEach((t=>{const[e,a]=t.split("=");n[e]=a}));else if(t.includes("[")){const e=t.match(/\[(.*?)\]/g).map((t=>t.replace(/\[|\]/g,"").split(",").map(Number)));a.push([{x:e[0][0],y:e[0][1]},{x:e[1][0],y:e[1][1]}]),s.push(1)}else{var e;const n=null===(e=t.match(/\((.*?)\)/g))||void 0===e?void 0:e.map((t=>{const[e,n]=t.replace(/\(|\)/g,"").split(",").map(Number);return{x:e,y:n}}));n&&(a.push(n),s.push(0))}})),{options:n,points:a,shapeTypes:s}}(e);return m(t),h(n),f(a),S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)}),[e]);const C=(t,e)=>{t.evt.preventDefault(),h((t=>{const n=t[e];if(!Array.isArray(n))return console.error("Expected an array of points, got:",n),t;const a=n.map((t=>({x:t.x+20,y:t.y+20})));return[...t,a]})),f((t=>[...t,t[e]]))};function E(t,e,n,a,s,i){let r=Math.sqrt((s-n)**2+(i-a)**2);if(0===r)return Math.sqrt((t-n)**2+(e-a)**2);let h=((t-n)*(s-n)+(e-a)*(i-a))/r**2;h=Math.max(0,Math.min(1,h));let o=n+h*(s-n),x=a+h*(i-a);return Math.sqrt((t-o)**2+(e-x)**2)}const N=(t,e,a)=>{const s=function(t,e,n,a){for(let s=0;s<o.length;s++)for(let i=0;i<o[s].length;i++){if(s===n&&i===a)continue;const r=o[s][i];if(Math.abs(r.x-t)<10&&Math.abs(r.y-e)<10)return r}return null}(t.target.x(),t.target.y(),e,a);if(s){const i=s.x/c.width*b.width,r=s.y/c.height*b.height,o=n.map(((t,n)=>n===e?t.map(((t,e)=>e===a?{x:i,y:r}:t)):t));h(o);const l=o.map((t=>t.map((t=>({x:t.x/b.width*c.width,y:t.y/b.height*c.height})))));x(l),t.target.position({x:s.x,y:s.y})}else{const n=o[e][a];t.target.position({x:n.x,y:n.y})}t.target.getLayer().batchDraw()},q=(t,e,n)=>{const a=c.width/b.width,s=c.height/b.height,i=t.target.x()/a,r=t.target.y()/s;if(i<20||i>b.width-20||r<0||r>b.height-20)return;const l=o.map(((a,s)=>s===e?a.map(((e,a)=>a===n?{x:t.target.x(),y:t.target.y()}:e)):a));x(l);const g=l.map((t=>t.map((t=>({x:t.x*b.width/c.width,y:t.y*b.height/c.height})))));h(g)};function F(t){return Math.sqrt(t.x*t.x+t.y*t.y)}return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:i,children:(0,r.jsxs)(s.Hf,{width:c.width,height:c.height,className:i,children:[(0,r.jsxs)(s.mh,{children:[(0,r.jsx)(s.UL,{x:0,y:0,width:c.width,height:c.height,stroke:"black",strokeWidth:4}),o.map(((t,e)=>(0,r.jsxs)(a.Fragment,{children:[0===w[e]&&(0,r.jsx)(s.x1,{points:t.flatMap((t=>[t.x,t.y])),closed:!0,stroke:"black",onDblClick:t=>((t,e)=>{const a=t.target.getStage().getPointerPosition(),s=c.width/b.width,i=c.height/b.height,r=a.x/s,o=a.y/i,x=n[e];let l=0,g=1/0;for(let n=0;n<x.length;n++){const t=(n+1)%x.length,e=E(r,o,x[n].x,x[n].y,x[t].x,x[t].y);e<g&&(g=e,l=n)}const y={x:r,y:o},d=[...x.slice(0,l+1),y,...x.slice(l+1)],u=[...n.slice(0,e),d,...n.slice(e+1)];h(u),D(u)})(t,e),onContextMenu:t=>C(t,e),draggable:!0,onDragStart:v,onDragEnd:t=>j(t,e)}),1===w[e]&&(0,r.jsx)(s.Cd,{x:t[0].x,y:t[0].y,radius:Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2)),stroke:"black",strokeWidth:2,onContextMenu:t=>C(t,e),draggable:!0,onDragStart:v,onDragEnd:t=>j(t,e)}),t.map(((t,n)=>(0,r.jsx)(s.Cd,{x:t.x,y:t.y,radius:5,fill:"red",draggable:g,visible:g,onDragMove:t=>q(t,e,n),onDragEnd:t=>N(t,e,n),onDblClick:()=>k(e,n)},n))),t.length>2&&"yes"===p.angles&&t.map(((e,n)=>{const i=t[(n-1+t.length)%t.length],h=e,o=t[(n+1)%t.length],x=function(t,e,n){const a={x:t.x-e.x,y:t.y-e.y},s={x:n.x-e.x,y:n.y-e.y},i=function(t,e){return t.x*e.x+t.y*e.y}(a,s)/(F(a)*F(s));return Math.acos(i)*(180/Math.PI)}(i,h,o),l=x.toFixed(1)+"\xb0";if(Math.abs(x)>.5&&Math.abs(x-180)>.5){const t=t=>{const e=Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x/e,y:t.y/e}},e=t({x:i.x-h.x,y:i.y-h.y}),x=t({x:o.x-h.x,y:o.y-h.y}),y=t({x:e.x+x.x,y:e.y+x.y});let d=c.width/45,u=Math.atan2(y.y,y.x)*(180/Math.PI);return(u<-90||u>90)&&(u+=180,d*=3),(0,r.jsx)(a.Fragment,{children:(0,r.jsx)(s.xv,{x:h.x+y.x*d,y:h.y+y.y*d,text:l,fontSize:12,fill:"black",visible:g,rotation:u})},n)}return null}))]},e)))]}),(0,r.jsx)(s.mh,{children:o.map(((t,e)=>(0,r.jsx)(a.Fragment,{children:t.map(((t,n)=>(0,r.jsx)(s.Cd,{x:t.x,y:t.y,radius:5,fill:"red",draggable:g,visible:g,onDragMove:t=>q(t,e,n),onDragEnd:t=>N(t,e,n),onDblClick:()=>k(e,n)},n)))},"v".concat(e))))})]})})})}}}]);
//# sourceMappingURL=7150.b0962737.chunk.js.map