{"version":3,"file":"static/js/262.f739111e.chunk.js","mappings":"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","sources":["components/ImagePins.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport \"./ImagePins.css\"; // Make sure to create corresponding CSS\nimport { handleImageFileChange } from \"../ImageUploads\";\nimport { useEditContext } from \"../EditContext\";\n\nconst LOCAL_MARKER = \"[local]\";\n\nfunction ImagePins({ text }) {\n  const [pins, setPins] = useState([]);\n  const [showInstruction, setShowInstruction] = useState(true);\n  const [draggedLabelIndex, setDraggedLabelIndex] = useState(null);\n  const { textData, setTextData } = useEditContext();\n\n  const imgRef = useRef(null);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setShowInstruction(false);\n    }, 1000);\n    return () => clearTimeout(timer);\n  }, []);\n\n  const placePin = (e) => {\n    if (!imgRef.current) return;\n\n    const rect = imgRef.current.getBoundingClientRect();\n    let x = e.clientX - rect.left;\n    let y = e.clientY - rect.top;\n\n    // Add new pin to the array\n    setPins((prevPins) => [\n      ...prevPins,\n      {\n        x: Math.max(0, Math.min(x, rect.width - 20)),\n        y: Math.max(0, Math.min(y, rect.height - 20)),\n        label: \"\",\n        labelX: x, // Initial Label X (same as pin X initially)\n        labelY: y - 40, // Initial Label Y (slightly above pin Y)\n      },\n    ]);\n  };\n\n  const handleRightClick = (e, index) => {\n    e.preventDefault(); // Prevent the browser context menu from opening\n    setPins((prevPins) => prevPins.filter((_, i) => i !== index)); // Remove the pin at the clicked index\n  };\n\n  const handleDoubleClick = (index) => {\n    const label = prompt(\"Enter a label for this pin:\", pins[index].label);\n    if (label !== null) {\n      // Check if the user didn't press Cancel\n      setPins(pins.map((pin, i) => (i === index ? { ...pin, label } : pin)));\n    }\n  };\n\n  // Adjusted onDragStart to prevent default behavior\n  const onDragStart = (e, index) => {\n    e.dataTransfer.setData(\"text/plain\", \"\"); // For Firefox compatibility\n    setDraggedLabelIndex(index);\n  };\n\n  // Moved onDragOver to the image-pin-container\n  const onDragOver = (e) => {\n    e.preventDefault(); // This is crucial for allowing the drop\n  };\n\n  const onDrop = (e) => {\n    if (!imgRef.current || draggedLabelIndex === null) return;\n\n    const rect = imgRef.current.getBoundingClientRect();\n    let labelX = e.clientX - rect.left;\n    let labelY = e.clientY - rect.top;\n\n    // Update only the label's position\n    setPins(\n      pins.map((pin, i) =>\n        i === draggedLabelIndex\n          ? { ...pin, labelX: labelX, labelY: labelY }\n          : pin\n      )\n    );\n\n    setDraggedLabelIndex(null); // Reset after drop\n  };\n\n  const updateImageData = (data) => {\n    setTextData(data);\n  };\n\n  return (\n    <div className=\"image-pin-maincontainer\">\n      <div\n        className=\"image-pin-container\"\n        draggable=\"false\" // Prevent the container from being draggable\n        onDragOver={onDragOver}\n        onDrop={onDrop}\n      >\n        {(!text.includes(LOCAL_MARKER) || textData) && (\n          <img\n            ref={imgRef}\n            className=\"image-pin-image\"\n            alt=\"Highlight\"\n            onClick={placePin}\n            draggable=\"false\"\n            src={text && !text.includes(LOCAL_MARKER) ? text : textData}\n            crossOrigin=\"anonymous\"\n          />\n        )}\n\n        {text.includes(LOCAL_MARKER) && !textData && (\n          <div>\n            The local image will need to be provided...\n            <br />{\" \"}\n            <input\n              type=\"file\"\n              className=\"fileUpload\"\n              accept=\"image/*\"\n              onChange={(event) =>\n                handleImageFileChange(event.target.files[0], updateImageData)\n              }\n            />\n          </div>\n        )}\n\n        {pins.map((pin, index) => (\n          <React.Fragment key={`pinlabel-${index}`}>\n            <div\n              key={`pin-${index}`}\n              className=\"pin\"\n              style={{ left: `${pin.x - 10}px`, top: `${pin.y - 10}px` }}\n              onContextMenu={(e) => handleRightClick(e, index)}\n              onDoubleClick={() => handleDoubleClick(index)}\n            ></div>\n            {pin.label && (\n              <div\n                className=\"pin-label\"\n                style={{ left: `${pin.labelX}px`, top: `${pin.labelY}px` }} // Use labelX and labelY for positioning\n                draggable=\"true\"\n                onDragStart={(e) => onDragStart(e, index)}\n              >\n                {pin.label}\n              </div>\n            )}\n          </React.Fragment>\n        ))}\n      </div>\n      {showInstruction && (\n        <div className=\"image-pin-instruction\">\n          <h1>Image Pins</h1>\n          <p>\n            click to drop pins, right-click to delete pin, double-click to add a\n            label; drag labels to reposition.\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default ImagePins;\n"],"names":["LOCAL_MARKER","_ref","text","pins","setPins","useState","showInstruction","setShowInstruction","draggedLabelIndex","setDraggedLabelIndex","textData","setTextData","useEditContext","imgRef","useRef","useEffect","timer","setTimeout","clearTimeout","updateImageData","data","_jsxs","className","children","draggable","onDragOver","e","preventDefault","onDrop","current","rect","getBoundingClientRect","labelX","clientX","left","labelY","clientY","top","map","pin","i","includes","_jsx","ref","alt","onClick","x","y","prevPins","Math","max","min","width","height","label","src","crossOrigin","type","accept","onChange","event","handleImageFileChange","target","files","index","React","style","concat","onContextMenu","handleRightClick","filter","_","onDoubleClick","prompt","handleDoubleClick","onDragStart","dataTransfer","setData"],"sourceRoot":""}