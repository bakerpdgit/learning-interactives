"use strict";(self.webpackChunkclass_interactives=self.webpackChunkclass_interactives||[]).push([[9131],{9131:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var n=a(2791),l=a(5851),i=a(6187);const s={imagePinMaincontainer:"ImagePins_imagePinMaincontainer__Hdvxe",imagePinContainer:"ImagePins_imagePinContainer__HzCEU",imagePinImage:"ImagePins_imagePinImage__GsK0P",pinLabel:"ImagePins_pinLabel__oO3mG",correctLabel:"ImagePins_correctLabel__ePIXx",errorLabel:"ImagePins_errorLabel__QkAwH",hiddenLabelsContainer:"ImagePins_hiddenLabelsContainer__+R9hw",hiddenLabel:"ImagePins_hiddenLabel__r+j-D",imagePinInstruction:"ImagePins_imagePinInstruction__TaSck",pin:"ImagePins_pin__S6-cr",pinDraggable:"ImagePins_pinDraggable__sbKgH",celebration:"ImagePins_celebration__LA+Dx",flyAcross:"ImagePins_flyAcross__Pgx19"};var r=a(9767);const c="MessageModal_modalOverlay__pU6wh",o="MessageModal_modalContent__C7it7",d="MessageModal_messageText__YwpjU",g="MessageModal_okButton__KYk8O";var h=a(184);const u=e=>{let{message:t,onClose:a}=e;return(0,h.jsx)("div",{className:c,children:(0,h.jsxs)("div",{className:o,children:[(0,h.jsx)("p",{className:d,children:t}),(0,h.jsx)("button",{className:g,onClick:a,children:"OK"})]})})};var m=a(5249);const p=function(e){let{text:t}=e;const[a,c]=(0,n.useState)([]),[o,d]=(0,n.useState)(0),[g,p]=(0,n.useState)([]),[b,f]=(0,n.useState)(!0),[x,_]=(0,n.useState)(!1),[v,P]=(0,n.useState)(!1),[w,y]=(0,n.useState)(""),[I,j]=(0,n.useState)({}),[C,L]=(0,n.useState)({type:null,index:null,startX:0,startY:0}),[X,Y]=(0,n.useState)(null),[M,D]=(0,n.useState)({width:0,height:0}),{textData:S,imageData:k,setImageData:N}=(0,i.c)(),H=(0,n.useRef)(null);(0,n.useEffect)((()=>{const e=t.split("\n"),a=e[0].startsWith("OPTIONS:")?e.shift():null,n=e.pop();let l=!1;if(a){a.substring(8).split(",").forEach((e=>{const[t,a]=e.split("=");"show"===t&&"yes"===a?l=!0:"disable_adding"===t&&"yes"===a&&P(!0)}))}const i=[];if(e.length>0){let t=0;const a=e.map(((e,a)=>{const n=e.match(/\((\d+(\.\d+)?),(\d+(\.\d+)?)\)$/);if(n){t++,e=e.replace(n[0],""),i.push(e);const a=parseFloat(n[1]),l=parseFloat(n[3]),s=a/100*M.width,r=l/100*M.height;return{x:s,y:r,label:"",labelX:s,labelY:r-40,hidden:!0,labelAnswer:e,provided:!0,answered:!1}}{const n=a-t,l=50+70*Math.floor(n/5),i=50+n%5*70;return{x:l,y:i,label:e,labelX:l,labelY:i-40,hidden:!1,provided:!0}}}));c(a),d(t),l&&p(i.sort((()=>Math.random()-.5)))}Y(n&&!n.includes(r.XH)?n:k)}),[t,S,k,M.width,M.height]),(0,n.useEffect)((()=>{const e=setTimeout((()=>{H.current&&(D({width:H.current.offsetWidth,height:H.current.offsetHeight}),c((e=>e.map((e=>e.x>H.current.offsetWidth||e.y>H.current.offsetHeight?{...e,x:100,y:100,labelX:100,labelY:50}:e)))))}),1e3);return()=>clearTimeout(e)}),[X]),(0,n.useEffect)((()=>{const e=setTimeout((()=>{f(!1)}),1e3);return()=>clearTimeout(e)}),[]),(0,n.useEffect)((()=>{const e=()=>{if(!H.current||0===M.width||0===M.height)return;const e=H.current.offsetWidth/M.width,t=H.current.offsetHeight/M.height;let n=a.map((a=>({...a,x:a.x*e,y:a.y*t,labelX:a.labelX*e,labelY:a.labelY*t})));n=n.map((e=>e.x>H.current.offsetWidth||e.y>H.current.offsetHeight?{...e,x:100,y:100,labelX:100,labelY:50}:e)),c(n),H.current&&D({width:H.current.offsetWidth,height:H.current.offsetHeight})};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[M,a]);const T=(e,t,n)=>{e.dataTransfer.setData("text/plain","");const l=a[t],i="pin"===n?l.x:l.labelX,s="pin"===n?l.y:l.labelY;L({type:n,index:t,startX:i,startY:s})},A=e=>{N(e),Y(e)};return(0,h.jsxs)(h.Fragment,{children:[""!==w&&(0,h.jsx)(u,{message:w,onClose:()=>{y("")}}),I.prompt&&(0,h.jsx)(m.Z,{title:I.prompt,placeholder:"type here...",value:I.value,onSubmit:e=>{const t=I.currentPinIndex;if(j({}),!a[t].answered&&null!==e)if(a[t].hidden){if(e.trim().toLowerCase().replace(/\s+/g,"")===a[t].labelAnswer.trim().toLowerCase().replace(/\s+/g,"")){c(a.map(((e,n)=>n===t?{...e,label:a[t].labelAnswer,hidden:!0,answered:!0}:e)));const e=o-1;d(e),0===e&&_(!0)}else c(a.map(((e,a)=>a===t?{...e,label:"try again",error:!0}:e))),setTimeout((()=>{c(a.map(((e,a)=>a===t?{...e,label:"",error:!1}:e)))}),1e3)}else c(a.map(((a,n)=>n===t?{...a,label:e}:a)))},onClose:()=>j({})}),(0,h.jsxs)("div",{className:s.imagePinMaincontainer,children:[(0,h.jsxs)("div",{className:s.imagePinContainer,draggable:"false",onDragOver:e=>{e.preventDefault()},onDrop:e=>{if(!H.current||null===C.index)return;const t=H.current.getBoundingClientRect();let n=e.clientX-t.left,l=e.clientY-t.top;const i=n-C.startX,s=l-C.startY;c(a.map(((e,t)=>t===C.index?{...e,x:e.x+("pin"===C.type?i:0),y:e.y+("pin"===C.type?s:0),labelX:e.labelX+i,labelY:e.labelY+s}:e))),L({type:null,index:null,startX:0,startY:0})},children:[(!t.includes(r.XH)||S)&&(0,h.jsx)("img",{ref:H,className:s.imagePinImage,alt:"Highlight",onClick:e=>{if(v)return void y("Adding pins is disabled for this task.");if(!H.current)return;const t=H.current.getBoundingClientRect();let a=e.clientX-t.left,n=e.clientY-t.top;c((e=>[...e,{x:Math.max(0,Math.min(a,t.width-20)),y:Math.max(0,Math.min(n,t.height-20)),label:"",labelX:a,labelY:n-40,provided:!1}]))},draggable:"false",src:X,crossOrigin:"anonymous"}),t.includes(r.XH)&&!S&&(0,h.jsxs)("div",{children:["The local image will need to be provided...",(0,h.jsx)("br",{})," ",(0,h.jsx)("input",{type:"file",className:s.fileUpload,accept:"image/*",onChange:e=>(0,l.v)(e.target.files[0],A)})]}),a.map(((e,t)=>(0,h.jsxs)(n.Fragment,{children:[(0,h.jsx)("div",{className:"".concat(s.pin," ").concat(e.hidden?"":s.pinDraggable),style:{left:"".concat(e.x-10,"px"),top:"".concat(e.y-10,"px")},draggable:!e.hidden,onDragStart:e=>T(e,t,"pin"),onContextMenu:e=>((e,t)=>{e.preventDefault(),c((e=>e.filter(((e,a)=>a!==t||e.provided))))})(e,t),onDoubleClick:()=>(e=>{a[e].answered||j({prompt:"Enter a label for this pin:",value:a[e].label,currentPinIndex:e})})(t)},"pin-".concat(t)),e.label&&(0,h.jsx)("div",{className:"".concat(s.pinLabel," ").concat(!0===e.hidden?s.correctLabel:""," ").concat(e.error?s.errorLabel:""),style:{left:"".concat(e.labelX,"px"),top:"".concat(e.labelY-10,"px")},draggable:"true",onDragStart:e=>T(e,t,"label"),children:e.label})]},"pinlabel-".concat(t))))]}),b&&(0,h.jsxs)("div",{className:s.imagePinInstruction,children:[(0,h.jsx)("h1",{children:"Image Pins"}),(0,h.jsx)("p",{children:"click to drop pins, right-click to delete pin, double-click to add a label; drag labels to reposition."})]})]}),g&&o>0&&(0,h.jsxs)("div",{className:s.hiddenLabelsContainer,children:["Double-click pins to add:",g.filter((e=>!a.some((t=>t.labelAnswer===e&&t.answered)))).map(((e,t)=>(0,h.jsx)("div",{className:s.hiddenLabel,children:e},"hiddenLbl".concat(t))))]}),x&&(0,h.jsx)("div",{className:s.celebration,children:"\ud83c\udfba"})]})}}}]);
//# sourceMappingURL=9131.f667b82c.chunk.js.map