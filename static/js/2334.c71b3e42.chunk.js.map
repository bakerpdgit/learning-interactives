{"version":3,"file":"static/js/2334.c71b3e42.chunk.js","mappings":"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","sources":["webpack://class-interactives/./src/components/AudioWordComplete.module.css?405c","components/AudioWordComplete.js"],"sourcesContent":["// extracted by mini-css-extract-plugin\nexport default {\"audioWordCompleteContainer\":\"AudioWordComplete_audioWordCompleteContainer__HYZRY\",\"audioPlayer\":\"AudioWordComplete_audioPlayer__5VfU9\",\"sentence\":\"AudioWordComplete_sentence__U-0yV\",\"inputBox\":\"AudioWordComplete_inputBox__2gpj3\",\"foundWord\":\"AudioWordComplete_foundWord__TCqCY\",\"wrong\":\"AudioWordComplete_wrong__KtE0s\",\"nextQuestion\":\"AudioWordComplete_nextQuestion__ciWpJ\",\"celebration\":\"AudioWordComplete_celebration__koUjh\",\"pop\":\"AudioWordComplete_pop__Seee4\"};","import React, { useState, useEffect, useRef } from \"react\";\r\nimport ReactPlayer from \"react-player\";\r\nimport styles from \"./AudioWordComplete.module.css\";\r\n\r\nfunction AudioWordComplete({ text }) {\r\n  const [blocks, setBlocks] = useState([]);\r\n  const [currentBlockIndex, setCurrentBlockIndex] = useState(0);\r\n  const [celebrate, setCelebrate] = useState(false);\r\n  const [currentSentence, setCurrentSentence] = useState(\"\");\r\n  const [currentBlock, setCurrentBlock] = useState(null);\r\n  const [asteriskedWords, setAsteriskedWords] = useState([]);\r\n  const [userInputs, setUserInputs] = useState({});\r\n  const [allCorrect, setAllCorrect] = useState(false);\r\n  const [playing, setPlaying] = useState(false);\r\n\r\n  const playerRef = useRef(null);\r\n  const inputRefs = useRef({});\r\n\r\n  useEffect(() => {\r\n    const parseBlocks = () => {\r\n      const rawBlocks = text.trim().split(/\\r?\\n\\s*\\r?\\n/);\r\n      const parsedBlocks = rawBlocks\r\n        .map((block, index) => {\r\n          const lines = block.split(/\\r?\\n/).map((line) => line.trim());\r\n          if (lines.length !== 4) {\r\n            console.error(\r\n              `Block ${index + 1}: Expected 4 lines but got ${lines.length}.`\r\n            );\r\n            return null;\r\n          }\r\n          const [url, startTime, endTime, sentence] = lines;\r\n          return {\r\n            url,\r\n            startTime: parseFloat(startTime),\r\n            endTime: parseFloat(endTime),\r\n            sentence,\r\n          };\r\n        })\r\n        .filter((block) => block !== null);\r\n      setBlocks(parsedBlocks);\r\n    };\r\n    parseBlocks();\r\n  }, [text]);\r\n\r\n  useEffect(() => {\r\n    if (blocks.length > 0 && currentBlockIndex < blocks.length) {\r\n      const block = blocks[currentBlockIndex];\r\n      setCurrentBlock(block);\r\n      setCurrentSentence(block.sentence);\r\n\r\n      // Extract asterisked words\r\n      const regex = /\\*([^\\s]+)/g;\r\n      const words = [];\r\n      let match;\r\n      while ((match = regex.exec(block.sentence)) !== null) {\r\n        let word = match[1];\r\n        // Remove any trailing punctuation marks\r\n        word = word.replace(/[.,?!]+$/, \"\");\r\n        words.push(word);\r\n      }\r\n      setAsteriskedWords(words);\r\n\r\n      // Initialize user inputs\r\n      const inputs = {};\r\n      words.forEach((word) => {\r\n        inputs[word] = \"\";\r\n      });\r\n      setUserInputs(inputs);\r\n      setAllCorrect(false);\r\n      setPlaying(true); // Start playing immediately\r\n      // Remove inputRefs.current reset from here\r\n    } else if (currentBlockIndex >= blocks.length && blocks.length > 0) {\r\n      setCelebrate(true);\r\n    }\r\n  }, [blocks, currentBlockIndex]);\r\n\r\n  useEffect(() => {\r\n    const allCorrect = asteriskedWords.every(\r\n      (w) => userInputs[w].trim().toLowerCase() === w.toLowerCase()\r\n    );\r\n    setAllCorrect(allCorrect);\r\n\r\n    // Focus on the first incomplete input\r\n    if (!allCorrect) {\r\n      const nextWord = asteriskedWords.find(\r\n        (word) => userInputs[word].trim().toLowerCase() !== word.toLowerCase()\r\n      );\r\n      if (nextWord && inputRefs.current[nextWord]) {\r\n        inputRefs.current[nextWord].focus();\r\n      }\r\n    }\r\n  }, [userInputs, asteriskedWords]);\r\n\r\n  const handleInputChange = (e) => {\r\n    const word = e.target.dataset.word;\r\n    const value = e.target.value;\r\n    setUserInputs((prevInputs) => ({\r\n      ...prevInputs,\r\n      [word]: value,\r\n    }));\r\n  };\r\n\r\n  const handleKeyDown = (e) => {\r\n    if (e.key === \"Enter\") {\r\n      const word = e.target.dataset.word;\r\n      const inputValue = userInputs[word];\r\n      if (inputValue.trim().toLowerCase() === word.toLowerCase()) {\r\n        // Correct\r\n        setUserInputs((prevInputs) => ({\r\n          ...prevInputs,\r\n          [word]: inputValue,\r\n        }));\r\n      } else {\r\n        // Incorrect, flash red\r\n        e.target.classList.add(styles.wrong);\r\n        setTimeout(() => {\r\n          e.target.classList.remove(styles.wrong);\r\n        }, 500);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handlePlayAudio = () => {\r\n    if (playerRef.current) {\r\n      playerRef.current.seekTo(currentBlock.startTime, \"seconds\");\r\n      setPlaying(true);\r\n    }\r\n  };\r\n\r\n  const handleProgress = (state) => {\r\n    const currentTime = state.playedSeconds;\r\n    if (currentTime >= currentBlock.endTime) {\r\n      setPlaying(false);\r\n    }\r\n  };\r\n\r\n  const nextQuestion = () => {\r\n    setCurrentBlockIndex((prevIndex) => prevIndex + 1);\r\n  };\r\n\r\n  const getSentenceElements = () => {\r\n    inputRefs.current = {}; // Reset input refs here\r\n\r\n    const elements = [];\r\n    let tempSentence = currentSentence;\r\n    // Remove asterisks for display\r\n    tempSentence = tempSentence.replace(/\\*/g, \"\");\r\n\r\n    const tokens = tempSentence.split(/(\\s+)/); // Split by spaces, keeping them\r\n    tokens.forEach((token, index) => {\r\n      const trimmedToken = token.trim();\r\n      // Extract trailing punctuation\r\n      const wordMatch = trimmedToken.match(/^([^\\s.,?!]+)([.,?!]*)$/);\r\n      if (wordMatch) {\r\n        // eslint-disable-next-line\r\n        const [_, wordWithoutPunct, punctuation] = wordMatch;\r\n\r\n        if (asteriskedWords.includes(wordWithoutPunct)) {\r\n          const inputValue = userInputs[wordWithoutPunct] || \"\";\r\n          const isCorrect =\r\n            inputValue.trim().toLowerCase() === wordWithoutPunct.toLowerCase();\r\n          if (isCorrect) {\r\n            elements.push(\r\n              <span\r\n                key={index}\r\n                className={styles.foundWord}\r\n                style={{ minWidth: `${wordWithoutPunct.length}ch` }}\r\n              >\r\n                {wordWithoutPunct}\r\n              </span>\r\n            );\r\n          } else {\r\n            elements.push(\r\n              <input\r\n                key={index}\r\n                ref={(el) => {\r\n                  if (el) {\r\n                    inputRefs.current[wordWithoutPunct] = el;\r\n                  }\r\n                }}\r\n                type=\"text\"\r\n                data-word={wordWithoutPunct}\r\n                value={inputValue}\r\n                onChange={handleInputChange}\r\n                onKeyDown={handleKeyDown}\r\n                style={{ width: `${wordWithoutPunct.length}ch` }}\r\n                className={styles.inputBox}\r\n              />\r\n            );\r\n          }\r\n          // Add the punctuation back\r\n          elements.push(punctuation);\r\n        } else {\r\n          elements.push(token);\r\n        }\r\n      } else {\r\n        elements.push(token);\r\n      }\r\n    });\r\n    return elements;\r\n  };\r\n\r\n  if (celebrate) {\r\n    return (\r\n      <div className={styles.celebration}>\r\n        <span role=\"img\" aria-label=\"celebrate\">\r\n          🎉\r\n        </span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!currentBlock) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className={styles.audioWordCompleteContainer}>\r\n      <div className={styles.audioPlayer}>\r\n        <button onClick={handlePlayAudio}>Repeat Audio</button>\r\n      </div>\r\n      <ReactPlayer\r\n        ref={playerRef}\r\n        url={currentBlock.url}\r\n        playing={playing}\r\n        controls={false}\r\n        width=\"0\"\r\n        height=\"0\"\r\n        onProgress={handleProgress}\r\n        onEnded={() => setPlaying(false)}\r\n        config={{\r\n          youtube: {\r\n            playerVars: {\r\n              autoplay: 1,\r\n              controls: 0,\r\n              start: currentBlock.startTime,\r\n              end: currentBlock.endTime,\r\n            },\r\n          },\r\n        }}\r\n      />\r\n      <div className={styles.sentence}>{getSentenceElements()}</div>\r\n      {allCorrect && (\r\n        <div className={styles.nextQuestion}>\r\n          <button onClick={nextQuestion}>Next Question</button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default AudioWordComplete;\r\n"],"names":["_ref","text","blocks","setBlocks","useState","currentBlockIndex","setCurrentBlockIndex","celebrate","setCelebrate","currentSentence","setCurrentSentence","currentBlock","setCurrentBlock","asteriskedWords","setAsteriskedWords","userInputs","setUserInputs","allCorrect","setAllCorrect","playing","setPlaying","playerRef","useRef","inputRefs","useEffect","parseBlocks","parsedBlocks","trim","split","map","block","index","lines","line","length","console","error","concat","url","startTime","endTime","sentence","parseFloat","filter","regex","words","match","exec","word","replace","push","inputs","forEach","every","w","toLowerCase","nextWord","find","current","focus","handleInputChange","e","target","dataset","value","prevInputs","handleKeyDown","key","inputValue","classList","add","styles","setTimeout","remove","_jsx","className","children","role","_jsxs","onClick","handlePlayAudio","seekTo","ReactPlayer","ref","controls","width","height","onProgress","state","playedSeconds","onEnded","config","youtube","playerVars","autoplay","start","end","getSentenceElements","elements","tempSentence","token","wordMatch","_","wordWithoutPunct","punctuation","includes","style","minWidth","el","type","onChange","onKeyDown","nextQuestion","prevIndex"],"sourceRoot":""}