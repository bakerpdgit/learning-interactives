"use strict";(self.webpackChunkclass_interactives=self.webpackChunkclass_interactives||[]).push([[3097],{3097:(e,t,l)=>{l.r(t),l.d(t,{default:()=>w});var i=l(2791),n=l(5249);const s="Fishbone_container__wVv0B",a="Fishbone_canvas__NtPIH",o="Fishbone_controls__xQrzF",c="Fishbone_canvasWrapper__Um0W6",r="Fishbone_headTitle__6Z42k",d="Fishbone_branchTitleTop__We1uv",h="Fishbone_branchTitleBottom__WNk8Y",b="Fishbone_branchButtonsUp__2urmZ",u="Fishbone_branchButtonsDown__gvxwy",m="Fishbone_labelUp__xla2a",_="Fishbone_labelDown__VB2qa",f="Fishbone_labelLine__QbdcL",p="Fishbone_addLabel__VcABt",v="Fishbone_shiftLabel__Vq5pj";var x=l(184);const w=function(e){let{text:t}=e;const l=(0,i.useRef)(null),w=(0,i.useRef)(null),[k,S]=(0,i.useState)({}),[j,F]=(0,i.useState)({x:0,w:0}),[C,g]=(0,i.useState)((()=>t.split("\n").slice(1).filter((e=>""!==e.trim())).map(((e,t)=>({id:Date.now()+t,title:e.trim(),labels:[],labelShift:0}))))),[T,N]=(0,i.useState)(1),[y,M]=(0,i.useState)(160),[Y,z]=(0,i.useState)({show:!1,title:"",callback:null,value:"",deleteCallback:null}),B=t.split("\n")[0],D=(0,i.useCallback)((()=>{window.setTimeout((()=>{const e=w.current;if(!e)return;const t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);const l=e.height/2,i=Math.max(300,e.width/6),n=e.width-i-10;t.lineWidth=4,t.strokeStyle="black",t.beginPath(),t.moveTo(10,l),t.lineTo(n,l),t.stroke();const s=y,a=.45*e.height,o=a*Math.SQRT1_2,c=a*Math.SQRT1_2,r={};t.lineWidth=2,C.forEach(((e,i)=>{const a=Math.floor(i/2),d=n-(a+1)*s,h=l,b=d-o,u=h+("top"===(i%2===0?"top":"bottom")?-c:c);t.beginPath(),t.moveTo(d,h),t.lineTo(b,u),t.stroke(),r[e.id]={startX:d,startY:h,endX:b,endY:u,midX:(d+b)/2,midY:(h+u)/2}})),S(r),F({x:n,w:i})}),0)}),[C,y,w,S,F]);(0,i.useEffect)((()=>{const e=w.current,t=()=>{l.current&&e&&(e.width=e.offsetWidth,e.height=e.offsetHeight,D())};t();const i=setTimeout(t,50);return window.addEventListener("resize",t),()=>{clearTimeout(i),window.removeEventListener("resize",t)}}),[D]);const X=function(e,t){z({show:!0,title:e,callback:t,value:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",deleteCallback:arguments.length>3&&void 0!==arguments[3]?arguments[3]:null})},L=e=>{g((t=>t.filter((t=>t.id!==e))))},W=(e,t)=>{g((l=>l.map((l=>l.id===e?{...l,labels:l.labels.filter((e=>e.id!==t))}:l))))},E=T+.2,R=T+.1;return(0,x.jsxs)("div",{ref:l,className:s,children:[Y.show&&(0,x.jsx)(n.Z,{title:Y.title,value:Y.value,onSubmit:Y.callback,onDelete:Y.deleteCallback,onClose:()=>z({...Y,show:!1})}),(0,x.jsxs)("div",{className:o,children:[(0,x.jsx)("button",{onClick:()=>{X("Branch title",(e=>{e.trim()&&g((t=>[...t,{id:Date.now(),title:e,labels:[],labelShift:0}]))}))},children:"Add Branch"}),(0,x.jsx)("button",{onClick:()=>M((e=>e+20)),children:"Space \u2191"}),(0,x.jsx)("button",{onClick:()=>M((e=>Math.max(40,e-20))),children:"Space \u2193"}),(0,x.jsx)("button",{onClick:()=>N((e=>e+.1)),children:"Font \u2191"}),(0,x.jsx)("button",{onClick:()=>N((e=>Math.max(.5,e-.1))),children:"Font \u2193"})]}),(0,x.jsxs)("div",{className:c,children:[(0,x.jsx)("canvas",{ref:w,className:a}),j.w>0&&(0,x.jsx)("div",{className:r,style:{fontSize:"".concat(E,"em"),left:j.x,width:j.w},children:B}),C.map(((e,t)=>{const l=k[e.id];if(!l)return null;const n=t%2===0?"top":"bottom",s=e.labels||[],a=w.current?.45*w.current.offsetHeight:100;return(0,x.jsxs)(i.Fragment,{children:[(0,x.jsx)("div",{className:t%2===0?d:h,style:{left:l.endX,top:l.endY,fontSize:"".concat(R,"em")},onContextMenu:t=>{var l,i;t.preventDefault(),l=e.id,i=e.title,X("Edit branch",(e=>{e.trim()&&g((t=>t.map((t=>t.id===l?{...t,title:e}:t))))}),i,(()=>L(l)))},children:e.title}),(0,x.jsxs)("div",{className:t%2===0?b:u,style:{position:"absolute",left:l.endX,top:l.endY,display:"flex",gap:"5px"},children:[(0,x.jsx)("div",{className:p,style:{fontSize:"".concat(R,"em"),cursor:"pointer"},onClick:()=>{return t=e.id,void X("Label",(e=>{e.trim()&&g((l=>l.map((l=>l.id===t?{...l,labels:[...l.labels,{id:Date.now(),text:e}],labelShift:0}:l))))}));var t},children:"+"}),(0,x.jsx)("div",{className:v,style:{fontSize:"".concat(R,"em"),cursor:"pointer"},onClick:()=>(e=>{const t=w.current.height*Math.SQRT1_2/16;g((l=>l.map((l=>l.id===e?{...l,labelShift:l.labelShift+t}:l))))})(e.id),children:"bottom"===n?"\u2193":"\u2191"})]}),s.map(((t,i)=>{const o=s.length,c=o>0?(i+.5)/o:0,r=e.labelShift||0;let d=c+(a>0?(r%a+a)%a/a:0);d-=Math.floor(d);const h=l.startX+(l.endX-l.startX)*d,b=l.startY+(l.endY-l.startY)*d;return(0,x.jsxs)("div",{className:"top"===n?m:_,style:{left:h,top:b,fontSize:"".concat(T,"em")},onContextMenu:l=>{var i,n,s;l.preventDefault(),i=e.id,n=t.id,s=t.text,X("Edit label",(e=>{e.trim()&&g((t=>t.map((t=>t.id===i?{...t,labels:t.labels.map((t=>t.id===n?{...t,text:e}:t))}:t))))}),s,(()=>W(i,n)))},children:[t.text,(0,x.jsx)("div",{className:f,style:{left:-20,top:"50%",width:20}})]},t.id)}))]},e.id)}))]})]})}}}]);
//# sourceMappingURL=3097.4097a6b6.chunk.js.map