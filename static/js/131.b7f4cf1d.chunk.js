"use strict";(self.webpackChunkclass_interactives=self.webpackChunkclass_interactives||[]).push([[131],{9131:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var n=a(2791),l=a(5851),s=a(6187);const i={imagePinMaincontainer:"ImagePins_imagePinMaincontainer__ve+Rp",imagePinContainer:"ImagePins_imagePinContainer__gV26t",imagePinImage:"ImagePins_imagePinImage__IpjTM",pinLabel:"ImagePins_pinLabel__boY-Q",correctLabel:"ImagePins_correctLabel__qIafK",errorLabel:"ImagePins_errorLabel__8NLFJ",hiddenLabelsContainer:"ImagePins_hiddenLabelsContainer__E33Kt",hiddenLabel:"ImagePins_hiddenLabel__j-Yd4",imagePinInstruction:"ImagePins_imagePinInstruction__yX44S",pin:"ImagePins_pin__FcmAN",pinDraggable:"ImagePins_pinDraggable__-W5-y",celebration:"ImagePins_celebration__eLfSQ",flyAcross:"ImagePins_flyAcross__HgWSj"};var r=a(9767);const o="MessageModal_modalOverlay__TepVJ",c="MessageModal_modalContent__s8h0e",d="MessageModal_messageText__aBUkg",u="MessageModal_okButton__MYUiR";var h=a(184);const m=e=>{let{message:t,onClose:a}=e;return(0,h.jsx)("div",{className:o,children:(0,h.jsxs)("div",{className:c,children:[(0,h.jsx)("p",{className:d,children:t}),(0,h.jsx)("button",{className:u,onClick:a,children:"OK"})]})})};var p=a(5249);const g=function(e){let{text:t}=e;const[a,o]=(0,n.useState)([]),[c,d]=(0,n.useState)(0),[u,g]=(0,n.useState)([]),[b,_]=(0,n.useState)(!0),[f,x]=(0,n.useState)(!1),[v,y]=(0,n.useState)(!1),[I,j]=(0,n.useState)(""),[P,w]=(0,n.useState)({}),[C,M]=(0,n.useState)({type:null,index:null,startX:0,startY:0}),[N,L]=(0,n.useState)(null),[Y,S]=(0,n.useState)({width:0,height:0}),{textData:X,imageData:k,setImageData:D}=(0,s.c)(),T=(0,n.useRef)(null);(0,n.useEffect)((()=>{const e=t.split("\n"),a=e[0].startsWith("OPTIONS:")?e.shift():null,n=e.pop();let l=!1;if(a){a.substring(8).split(",").forEach((e=>{const[t,a]=e.split("=");"show"===t&&"yes"===a?l=!0:"disable_adding"===t&&"yes"===a&&y(!0)}))}const s=[];if(e.length>0){let t=0;const a=e.map(((e,a)=>{const n=e.match(/\((\d+(\.\d+)?),(\d+(\.\d+)?)\)$/);if(n){t++,e=e.replace(n[0],""),s.push(e);const a=parseFloat(n[1]),l=parseFloat(n[3]),i=a/100*Y.width,r=l/100*Y.height;return{x:i,y:r,label:"",labelX:i,labelY:r-40,hidden:!0,labelAnswer:e,provided:!0,answered:!1}}{const n=a-t,l=50+70*Math.floor(n/5),s=50+n%5*70;return{x:l,y:s,label:e,labelX:l,labelY:s-40,hidden:!1,provided:!0}}}));o(a),d(t),l&&g(s.sort((()=>Math.random()-.5)))}L(n&&!n.includes(r.XH)?n:k)}),[t,X,k,Y.width,Y.height]),(0,n.useEffect)((()=>{const e=setTimeout((()=>{T.current&&(S({width:T.current.offsetWidth,height:T.current.offsetHeight}),o((e=>e.map((e=>e.x>T.current.offsetWidth||e.y>T.current.offsetHeight?{...e,x:100,y:100,labelX:100,labelY:50}:e)))))}),1e3);return()=>clearTimeout(e)}),[N]),(0,n.useEffect)((()=>{const e=setTimeout((()=>{_(!1)}),1e3);return()=>clearTimeout(e)}),[]),(0,n.useEffect)((()=>{const e=()=>{if(!T.current||0===Y.width||0===Y.height)return;const e=T.current.offsetWidth/Y.width,t=T.current.offsetHeight/Y.height;let n=a.map((a=>({...a,x:a.x*e,y:a.y*t,labelX:a.labelX*e,labelY:a.labelY*t})));n=n.map((e=>e.x>T.current.offsetWidth||e.y>T.current.offsetHeight?{...e,x:100,y:100,labelX:100,labelY:50}:e)),o(n),T.current&&S({width:T.current.offsetWidth,height:T.current.offsetHeight})};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[Y,a]);const E=(e,t,n)=>{e.dataTransfer.setData("text/plain","");const l=a[t],s="pin"===n?l.x:l.labelX,i="pin"===n?l.y:l.labelY;M({type:n,index:t,startX:s,startY:i})},H=e=>{D(e),L(e)};return(0,h.jsxs)(h.Fragment,{children:[""!==I&&(0,h.jsx)(m,{message:I,onClose:()=>{j("")}}),P.prompt&&(0,h.jsx)(p.Z,{title:P.prompt,placeholder:"type here...",value:P.value,onSubmit:e=>{const t=P.currentPinIndex;if(w({}),!a[t].answered&&null!==e)if(a[t].hidden){if(e.trim().toLowerCase().replace(/\s+/g,"")===a[t].labelAnswer.trim().toLowerCase().replace(/\s+/g,"")){o(a.map(((e,n)=>n===t?{...e,label:a[t].labelAnswer,hidden:!0,answered:!0}:e)));const e=c-1;d(e),0===e&&x(!0)}else o(a.map(((e,a)=>a===t?{...e,label:"try again",error:!0}:e))),setTimeout((()=>{o(a.map(((e,a)=>a===t?{...e,label:"",error:!1}:e)))}),1e3)}else o(a.map(((a,n)=>n===t?{...a,label:e}:a)))},onClose:()=>w({})}),(0,h.jsxs)("div",{className:i.imagePinMaincontainer,children:[(0,h.jsxs)("div",{className:i.imagePinContainer,draggable:"false",onDragOver:e=>{e.preventDefault()},onDrop:e=>{if(!T.current||null===C.index)return;const t=T.current.getBoundingClientRect();let n=e.clientX-t.left,l=e.clientY-t.top;const s=n-C.startX,i=l-C.startY;o(a.map(((e,t)=>t===C.index?{...e,x:e.x+("pin"===C.type?s:0),y:e.y+("pin"===C.type?i:0),labelX:e.labelX+s,labelY:e.labelY+i}:e))),M({type:null,index:null,startX:0,startY:0})},children:[(!t.includes(r.XH)||X)&&(0,h.jsx)("img",{ref:T,className:i.imagePinImage,alt:"Highlight",onClick:e=>{if(v)return void j("Adding pins is disabled for this task.");if(!T.current)return;const t=T.current.getBoundingClientRect();let a=e.clientX-t.left,n=e.clientY-t.top;o((e=>[...e,{x:Math.max(0,Math.min(a,t.width-20)),y:Math.max(0,Math.min(n,t.height-20)),label:"",labelX:a,labelY:n-40,provided:!1}]))},draggable:"false",src:N,crossOrigin:"anonymous"}),t.includes(r.XH)&&!X&&(0,h.jsxs)("div",{children:["The local image will need to be provided...",(0,h.jsx)("br",{})," ",(0,h.jsx)("input",{type:"file",className:i.fileUpload,accept:"image/*",onChange:e=>(0,l.vh)(e.target.files[0],H)})]}),a.map(((e,t)=>(0,h.jsxs)(n.Fragment,{children:[(0,h.jsx)("div",{className:"".concat(i.pin," ").concat(e.hidden?"":i.pinDraggable),style:{left:"".concat(e.x-10,"px"),top:"".concat(e.y-10,"px")},draggable:!e.hidden,onDragStart:e=>E(e,t,"pin"),onContextMenu:e=>((e,t)=>{e.preventDefault(),o((e=>e.filter(((e,a)=>a!==t||e.provided))))})(e,t),onDoubleClick:()=>(e=>{a[e].answered||w({prompt:"Enter a label for this pin:",value:a[e].label,currentPinIndex:e})})(t)},"pin-".concat(t)),e.label&&(0,h.jsx)("div",{className:"".concat(i.pinLabel," ").concat(!0===e.hidden?i.correctLabel:""," ").concat(e.error?i.errorLabel:""),style:{left:"".concat(e.labelX,"px"),top:"".concat(e.labelY-10,"px")},draggable:"true",onDragStart:e=>E(e,t,"label"),children:e.label})]},"pinlabel-".concat(t))))]}),b&&(0,h.jsxs)("div",{className:i.imagePinInstruction,children:[(0,h.jsx)("h1",{children:"Image Pins"}),(0,h.jsx)("p",{children:"click to drop pins, right-click to delete pin, double-click to add a label; drag labels to reposition."})]})]}),u&&c>0&&(0,h.jsxs)("div",{className:i.hiddenLabelsContainer,children:["Double-click pins to add:",u.filter((e=>!a.some((t=>t.labelAnswer===e&&t.answered)))).map(((e,t)=>(0,h.jsx)("div",{className:i.hiddenLabel,children:e},"hiddenLbl".concat(t))))]}),f&&(0,h.jsx)("div",{className:i.celebration,children:"\ud83c\udfba"})]})}},5249:(e,t,a)=>{a.d(t,{Z:()=>h});var n=a(2791);const l="InputModal_modalOverlay__Y-bWN",s="InputModal_modalContent__z50rT",i="InputModal_modalTitle__FCo0P",r="InputModal_inputField__IeKtc",o="InputModal_buttonGroup__3nwbY",c="InputModal_submitButton__irpiv",d="InputModal_cancelButton__xmt2G";var u=a(184);const h=e=>{let{title:t,placeholder:a,value:h="",onSubmit:m,onClose:p}=e;const[g,b]=(0,n.useState)(h);(0,n.useEffect)((()=>{b(h)}),[h]);const _=()=>{m(g),p()};return(0,u.jsx)("div",{className:l,children:(0,u.jsxs)("div",{className:s,children:[(0,u.jsx)("h2",{className:i,children:t}),(0,u.jsx)("input",{type:"text",className:r,placeholder:a,value:g,onChange:e=>{b(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&_()},autoFocus:!0}),(0,u.jsxs)("div",{className:o,children:[(0,u.jsx)("button",{className:c,onClick:_,children:"Submit"}),(0,u.jsx)("button",{className:d,onClick:p,children:"Cancel"})]})]})})}}}]);
//# sourceMappingURL=131.b7f4cf1d.chunk.js.map